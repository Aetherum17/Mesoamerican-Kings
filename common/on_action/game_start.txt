# Called from code after history generation
# Empty scope
on_game_start = {
	effect = {
		#error suppression
		if = {
			limit = { always = no }
			ba_error_suppression = yes
		}
		every_religion_global = {
			every_faith = {
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = holy_site_other_grand_temple_01
					}
				}
			}
		}
		#Initial spoked wheel and composite bow exposure to start spread
		culture:haburi = {
			set_variable = {
				name = spoked_wheel_exposure
				value = 1
			}
			set_variable = {
				name = composite_bow_exposure
				value = 1
			}
		}
		culture:shubrian = {
			set_variable = {
				name = spoked_wheel_exposure
				value = 1
			}
			set_variable = {
				name = composite_bow_exposure
				value = 1
			}
		}
		culture:ishuwan = {
			set_variable = {
				name = spoked_wheel_exposure
				value = 1
			}
			set_variable = {
				name = composite_bow_exposure
				value = 1
			}
		}
		#Writing setup at start
		culture:sumerian = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:south_akkadian = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:assyrian = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:susanian = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:ellipian = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:anshanian = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:liyan = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:dilmunite = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:amoritic = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:eblaite = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:lullubi = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:tukri = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:haburi = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:harrani = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:minoan = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:mu_kedi = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:wahenian = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:upper_egyptian = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
		culture:lower_egyptian = { ba_add_innovation_with_exposure_effect = { NAME = writing } }

		#Just starting with exposure
		culture:sinaian = {
			set_variable = {
				name = writing_exposure
				value = 1
			}
		}
		culture:nesili = { #From assyrian trade colonies
			set_variable = {
				name = writing_exposure
				value = 1
			}
		}
		culture:ishuwan = { #From assyrian trade colonies
			set_variable = {
				name = writing_exposure
				value = 1
			}
		}
		culture:nubian = { #From the Egyptians, might already have it
			set_variable = {
				name = writing_exposure
				value = 1
			}
		}
		culture:maganite = { #From the Dilmunites
			set_variable = {
				name = writing_exposure
				value = 1
			}
		}
		culture:gutian = {
			set_variable = {
				name = writing_exposure
				value = 1
			}
		}
		if = { # 1590 bce start date, the earlier stuff still applies and don't need repeating
			limit = {
				current_date >= 1300.1.1
			}
			set_global_variable = {
				name = second_startdate
				value = 1
			}
			#Writing
			culture:cypriot = { ba_add_innovation_with_exposure_effect = { NAME = writing } } #Cypriot-Minoan script oldest 1550 bce, not sure if short or long but old enough that it probably? was there in 1590
			culture:hyksos = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			culture:nubian = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			culture:sinaian = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			#Canaanite, Proto script means it probably had it?
			culture:canaanite = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			culture:edomite = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			culture:ammonite = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			culture:moabite = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			culture:golanite = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			culture:phoenician = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			#End of Canaanites
			culture:nesili = { ba_add_innovation_with_exposure_effect = { NAME = writing } } #Hittite cuneiform
			culture:shubrian = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			culture:hattian = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			culture:ishuwan = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			culture:kassite = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			culture:tarhuntassan = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			culture:hapallan = { ba_add_innovation_with_exposure_effect = { NAME = writing } }
			culture:lukkan = { ba_add_innovation_with_exposure_effect = { NAME = writing } } #Hittite cuneiform or luwian hieroglyphs
			#Just exposure for some west anatolians
			culture:carian = {
				set_variable = {
					name = writing_exposure
					value = 1
				}
			}
			culture:miran = {
				set_variable = {
					name = writing_exposure
					value = 1
				}
			}
			culture:lydian = {
				set_variable = {
					name = writing_exposure
					value = 1
				}
			}
			#Some exposure for cyclades probably, from minoans
			culture:cycladic = {
				set_variable = {
					name = writing_exposure
					value = 1
				}
			}
			#Spoked wheel and Composite bow
			#Hurrians
			culture:tukri = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:haburi = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:shubrian = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:ishuwan = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:harrani = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:zalwari = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:kizzuni = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:nesili = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:kassite = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:amoritic = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:phoenician = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:aramean = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:golanite = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:canaanite = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:ammonite = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:moabite = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:edomite = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:hyksos = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:achaian = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:cypriot = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:tarhuntassan = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:palaic = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:hapallan = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:miran = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:lukkan = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:carian = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:assyrian = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			#Upper and lower egyptian, can't add progress towards it, so just gonna give them the innovation at start, could make some event that unlocks it on battle with hyksos or whatever. Or give them some negative modifier at start symbolizing they just picked it up or whatever
			culture:lower_egyptian = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			culture:upper_egyptian = { ba_add_innovation_with_exposure_effect = { NAME = spoked_wheel } }
			#Just exposure for Wahen and Mu-Kedi
			culture:wahenian = {
				set_variable = {
					name = spoked_wheel_exposure
					value = 1
				}
			}
			culture:mu_kedi = {
				set_variable = {
					name = spoked_wheel_exposure
					value = 1
				}
			}
			culture:south_akkadian = {
				set_variable = {
					name = spoked_wheel_exposure
					value = 1
				}
			}
			culture:lullubi = {
				set_variable = {
					name = spoked_wheel_exposure
					value = 1
				}
			}
			#Composite bow
			#Hurrians
			culture:tukri = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:haburi = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:shubrian = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:ishuwan = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:harrani = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:zalwari = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:kizzuni = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:nesili = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:kassite = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:amoritic = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:phoenician = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:aramean = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:golanite = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:canaanite = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:ammonite = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:moabite = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:edomite = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:hyksos = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:achaian = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:cypriot = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:tarhuntassan = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:palaic = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:hapallan = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:miran = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:lukkan = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:carian = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:assyrian = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			#Upper and lower egyptian, can't add progress towards it, so just gonna give them the innovation at start, could make some event that unlocks it on battle with hyksos or whatever. Or give them some negative modifier at start symbolizing they just picked it up or whatever
			culture:lower_egyptian = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			culture:upper_egyptian = { ba_add_innovation_with_exposure_effect = { NAME = composite_bow } }
			#Just exposure for Wahen and Mu-Kedi
			culture:wahenian = {
				set_variable = {
					name = composite_bow_exposure
					value = 1
				}
			}
			culture:mu_kedi = {
				set_variable = {
					name = composite_bow_exposure
					value = 1
				}
			}
			culture:south_akkadian = {
				set_variable = {
					name = composite_bow_exposure
					value = 1
				}
			}
			culture:lullubi = {
				set_variable = {
					name = composite_bow_exposure
					value = 1
				}
			}
		}
	}
	on_actions = {
	}
}

# Like on_game_start, except it is called once the host (or player, in single player) exits the lobby. Good for anything where you need to know who the players are, or what the game rules are
on_game_start_after_lobby = {
	effect = {
		### GAME RULE: VIEW ON SAME-SEX RELATIONS
		if = {
			limit = { has_game_rule = accepted_same_sex_relations }
			game_rule_accepted_same_sex_relations_effect = yes
		}

		### GAME RULE: RANDOM RULER PLACEMENT
		if = {
			limit = { NOT = { has_game_rule = random_ruler_placement_off } }
			game_rule_random_ruler_placement_effect = yes
		}

		### GAME RULE: RANDOMIZE FAITH
		if = {
			limit = { has_game_rule = randomized_faiths_on }
			game_rule_randomize_faith_effect = yes
		}

		### GAME RULE: FAITH ACCEPTANCE
		if = {
			limit = { has_game_rule = full_faith_acceptance }
			game_rule_faith_acceptance_effect = yes
		}

		### GAME RULE: GENDER EQUALITY ###
		if = {
			limit = { has_game_rule = full_gender_equality }
			game_rule_full_gender_equality_effect = yes
		}
		else_if = {
			limit = { has_game_rule = inversed_gender_equality }
			game_rule_inversed_gender_equality_effect = yes #todo fix
		}

		### GAME RULE: SEXUALITY DISTRIBUTION ###
		if = {
			limit = { NOT = { has_game_rule = sexuality_distribution_default } }
			game_rule_sexuality_distribution_effect = yes
		}

		### ACHIEVEMENT: FROM RAGS TO RICHES
		every_player = {
			limit = { highest_held_title_tier = tier_county }
			add_achievement_global_variable = {
				VARIABLE = achievement_rags_to_riches_valid
				VALUE = yes
			}
		}
		every_ruler = {
			trigger_event = {
				on_action = set_liege_distance_pulse
			}
			if = {
				limit = {
					highest_held_title_tier >= tier_duchy
					special_succession_city_confederation_trigger = yes
				}
				every_held_title = {
					limit = { 
						tier >= tier_duchy
						NOR = {
							has_title_law = city_confederation_elective_succession_law
							has_title_law = sumerian_elective_succession_law
							has_title_law = dynastic_elective_succession_law
						}
					}
					add_title_law = city_confederation_elective_succession_law
				}
			}
		}
		every_county = {
			ba_set_development_decay = yes
		}
	}

	events = {
		game_rule.1000	#Autopopulate families.
	}
}
